name: CICDTest 單元測試 (.NET 10 on Windows)

# 監聽 master 分支的 push 與 pull request
on:
  push:
    branches: [ "master" ]
  pull_request:
    branches: [ "master" ]

jobs:
  test:

    runs-on: windows-latest  # Windows runner

    steps:
    # 1. 取得原始碼
    - name: 取得原始碼
      uses: actions/checkout@v4

    # 2. 安裝 .NET 10 SDK
    - name: 安裝 .NET 10
      uses: actions/setup-dotnet@v4
      with:
        dotnet-version: 10.0.x

    # 3. 快取 NuGet 套件，加速 restore
    - name: 快取 NuGet 套件
      uses: actions/cache@v3
      with:
        path: ~/.nuget/packages
        key: nuget-${{ runner.os }}-${{ hashFiles('CICDTest/**/*.csproj') }}

    # 4. 還原套件
    - name: 還原套件
      working-directory: ./CICDTest
      run: dotnet restore

    # 5. 建置專案（不重新 restore）
    - name: 建置專案
      working-directory: ./CICDTest
      run: dotnet build --no-restore --configuration Release

    # 6. 執行單元測試
    - name: 執行單元測試
      working-directory: ./CICDTest
      run: dotnet test ./CICDTest.Tests/CICDTest.Tests.csproj --no-build --verbosity normal
